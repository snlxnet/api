<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="stylesheet" href="https://snlx.net/base.css">
<link rel="stylesheet" href="https://snlx.net/forms.css">
<link rel="stylesheet" href="https://snlx.net/garden.css">
<link rel="stylesheet" href="https://snlx.net/theme-mocha.css">
<style>
  form, input {
    width: 100%;
  }
  form {
    padding: 1rem 0;
  }
  button {
    font-size: inherit;
  }
  .button.accent {
    background-color: #94e2d5;
  }
  pre {
    overflow: auto;
    max-height: 80ch;
    padding: .6rem 1rem;
    margin: 1rem 0;
    background-color: #181825;
    border-radius: .6rem;
  }
</style>

<main class="content markdown">
  <img src="banner.svg">

  <p>
    This page is for testing purposes only. If you are here for the code,
    check out <a href="https://github.com/snlxnet/api">the repo</a>.

    If you want a story, I'll post about it on my main site soon
    and add a link.
  </p>

  <h2>Key</h2>
  <input id="pass" type="text">

  <h2>Upload</h2>
  <label>
    File name
    <input id="fileid" type="text">
  </label>
  <form id="upload" enctype="multipart/form-data" style="flex-direction: row">
    <label class="button">
      <input name="file" type="file" style="display: none">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-folder-open-icon lucide-folder-open"><path d="m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"/></svg>
      Choose file
    </label>
    <button class="button accent">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload-icon lucide-upload"><path d="M12 3v12"/><path d="m17 8-5-5-5 5"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/></svg>
      Upload
    </button>
  </form>

  <h2>Download</h2>
  <label>
    File name
    <input id="downloadid" type="text">
  </label>
  <pre id="fileview">Start typing to load</pre>

  <h2>Server management</h2>
  <button id="upgrade" class="button">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-fading-arrow-up-icon lucide-circle-fading-arrow-up"><path d="M12 2a10 10 0 0 1 7.38 16.75"/><path d="m16 12-4-4-4 4"/><path d="M12 16V8"/><path d="M2.5 8.875a10 10 0 0 0-.5 3"/><path d="M2.83 16a10 10 0 0 0 2.43 3.4"/><path d="M4.636 5.235a10 10 0 0 1 .891-.857"/><path d="M8.644 21.42a10 10 0 0 0 7.631-.38"/></svg>
    Upgrade the server
  </button>

  <h2>Status</h2>
  <pre id="statusview"></pre>
  <form id="statusform">
    <label>
      action
      <input id="action">
    </label>
    <label>
      link
      <input id="link">
    </label>
    <label>
      location
      <input id="location">
    </label>
    <label>
      duration
      <input id="duration">
    </label>
    <button class="button accent">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radio-tower-icon lucide-radio-tower"><path d="M4.9 16.1C1 12.2 1 5.8 4.9 1.9"/><path d="M7.8 4.7a6.14 6.14 0 0 0-.8 7.5"/><circle cx="12" cy="9" r="2"/><path d="M16.2 4.8c2 2 2.26 5.11.8 7.47"/><path d="M19.1 1.9a9.96 9.96 0 0 1 0 14.1"/><path d="M9.5 18h5"/><path d="m8 22 4-11 4 11"/></svg>
      Set Status
    </button>
  </form>
</main>

<div class="sidebar">
  <a href="/" class="logo-link">
    <img class="logo" src="/favicon.svg">
  </a>
  <h2>api</h2>
</div>

<script src="https://cdn.jsdelivr.net/npm/@arborium/arborium@1/dist/arborium.iife.js"></script>
<script data-manual>
  upload.addEventListener("submit", async (event) => {
    event.preventDefault()
    
    const formData = new FormData(upload)
    const response = await fetch(`/file?pass=${pass.value}&id=${fileid.value}`, {
      method: "POST",
      body: formData,
    })
  })

  upgrade.addEventListener("click", () => {
    fetch(`/upgrade?pass=${pass.value}`)
  })

  downloadid.addEventListener("input", async () => {
    const response = await fetch(`/file?id=${downloadid.value}`)
    fileview.textContent = await response.text()

    const ext = downloadid.value.split(".").at(-1)
    let lang

    if (ext === "ts") {
      lang = "typescript"
    } else if (ext === "html") {
      lang = "html"
    } else if (ext === "md") {
      lang = "markdown"
    } else {
      return
    }
    
    await window.arborium.highlightElement(fileview, lang)
  })

  const socket = new WebSocket(`wss://${window.location.host}/status`)
  socket.addEventListener("message", async ({ data }) => {
    const parsed = JSON.parse(data)
    console.log({data, parsed})
    statusview.textContent = JSON.stringify(parsed, null, 4)
    await window.arborium.highlightElement(statusview, "json")
  })

  statusform.addEventListener("submit", async (event) => {
    event.preventDefault()

    const url = `/status?pass=${val(pass)}&action=${val(action)}&link=${val(link)}&location=${val(location)}&duration=${val(duration)}`
    await fetch(url, { method: "POST" })

    function val(element) {
      return encodeURIComponent(element.value || "")
    }
  })
</script>

